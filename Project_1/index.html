<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>chat</title>
    <!-- js -->
    <!-- <script src="./index.js" defer type="module"></script> -->
  </head>
  <body>
    <div>
      <ul></ul>
      <form action="post">
        <input type="text" autofocus />
        <button type="submit">전송</button>
      </form>
    </div>
    <div id="contents"></div>
  </body>
  <script>
    let $input = document.querySelector("input");
    let $button = document.querySelector("button");

    let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;
    let data = [
      {
        role: "system",
        content: "assistant is a good gamer.",
      },
    ];

    $button.addEventListener("click", (e) => {
      e.preventDefault(); // 화면 멈춤. 아무런 액션이 일어나지 않음
      //console.log(e); // pointerEvent
      //console.log($input.value);

      //userInputData = JSON.stringify({ answer: $input.value });
      userInputData = $input.value;
      $input.value = "";

      data.push({
        role: "user",
        content: userInputData,
      });

      chatGptAPI();
    });

    function chatGptAPI() {
      fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
        redirect: "follow",
      })
        .then((res) => res.json())
        .then((res) => {
          console.log(res);
          console.log(res.choices[0].message.content);
          document.querySelector("#contents").innerText =
            res.choices[0].message.content;
        });
    }
  </script>
</html>
